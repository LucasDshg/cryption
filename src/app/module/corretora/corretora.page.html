<app-header title="Corretora"> </app-header>

<ion-content>
  <div class="ion-d-flex ion-overflow-auto ion-align-items-center">
    <ion-chip
      [outline]="true"
      class="ion-d-block ion-flex-1"
      [ngClass]="{ 'chip-selected': 'SAQUES' === tabSelected() }"
      (click)="toggleTab('SAQUES')"
    >
      Saques
    </ion-chip>

    <ion-chip
      [outline]="true"
      class="ion-d-block ion-flex-1"
      [ngClass]="{ 'chip-selected': 'DEPOSIT' === tabSelected() }"
      (click)="toggleTab('DEPOSIT')"
    >
      Depositar
    </ion-chip>
  </div>
  @switch (tabSelected()) {
    @case ('DEPOSIT') {
      <ng-container *ngTemplateOutlet="depositTemplate"></ng-container>
    }
    @case ('SAQUES') {
      <ng-container *ngTemplateOutlet="extratoTemplate"></ng-container>
    }
  }
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-button shape="round" expand="full" color="primary" (click)="back()">
      Voltar
    </ion-button>
  </ion-toolbar>
</ion-footer>

<ng-template #extratoTemplate>
  @defer (when data()) {
    @for (item of data()?.data; track item.id) {
      <ion-card class="ion-no-shadow" [button]="true" (click)="details(item)">
        <ion-card-content>
          <div
            class="ion-d-flex ion-justify-content-between ion-align-content-center"
          >
            <div class="ion-d-flex ion-flex-column ion-gap-8">
              <ion-text color="primary">
                <p class="ion-m-bottom-0 ion-fw-medium">
                  {{ item.amount | currency }}
                </p>
              </ion-text>
              <ion-text color="medium">
                <small>Taxa: {{ item.feeAmount | currency }}</small>
              </ion-text>
            </div>
            <div
              class="ion-d-flex ion-flex-column ion-align-items-end ion-gap-8"
            >
              @if (withdrawalsDic.get(item.status); as withdrawals) {
                <ion-badge class="ion-d-block" [color]="withdrawals.color">{{
                  withdrawals.name
                }}</ion-badge>
              }
              <ion-text color="medium">
                <small>{{ item.updatedAt | date }}</small>
              </ion-text>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    }
  } @placeholder {
    <app-card-loading type="titleAndSubtitle"></app-card-loading>
    <app-card-loading type="titleAndSubtitle"></app-card-loading>
    <app-card-loading type="titleAndSubtitle"></app-card-loading>
  }
</ng-template>

<ng-template #depositTemplate>
  <ion-card class="ion-no-shadow">
    <ion-card-header>
      <ion-card-title color="primary">PIX </ion-card-title>
      <ion-card-subtitle color="medium">
        <small>
          Gere o link pix para realizar o deposito no banco de sua preferÃªncia.
        </small>
      </ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      @if (linkCreated()) {
        <ion-card
          style="--ion-card-background: #000"
          [button]="true"
          class="ion-no-shadow"
          (click)="copy()"
        >
          <ion-card-content>
            <small class="ion-d-block">{{ linkCreated()?.qrCodeString }}</small>
          </ion-card-content>
        </ion-card>

        <ion-button
          shape="round"
          expand="full"
          color="primary"
          fill="clear"
          (click)="newLink()"
        >
          Gerar novo link
        </ion-button>
      } @else {
        <form [formGroup]="form">
          <ion-input
            formControlName="amout"
            label="Valor"
            label-placement="floating"
            fill="outline"
            type="tel"
            class="ion-m-bottom-16"
            [maskito]="masks.number"
            [maskitoElement]="masks.predicate"
          >
            <ion-text slot="start">$: </ion-text>
          </ion-input>
          <ion-input
            formControlName="doc"
            label="Documento"
            label-placement="floating"
            fill="outline"
            type="tel"
            class="ion-m-bottom-16"
          >
          </ion-input>
          <ion-button
            shape="round"
            expand="full"
            color="primary"
            fill="clear"
            [disabled]="loading()"
            (click)="createLink()"
          >
            @if (loading()) {
              <ion-spinner name="dots"></ion-spinner>
            } @else {
              Gerar link
            }
          </ion-button>
        </form>
      }
    </ion-card-content>
  </ion-card>
</ng-template>
